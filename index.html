<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Shayari by Prabhav Baba — WhatsApp UI</title>
<style>
  /* --- Minimal WhatsApp-style dark UI (mobile-first) --- */
  :root{
    --bg:#071028; --panel:#0f1530; --accent:#2ea6ff; --bubble-bot:#222654; --bubble-user:#0b84ff;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box;font-family:Inter,Segoe UI,system-ui,Arial; -webkit-font-smoothing:antialiased}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#030318);color:#eef2ff}
  .wrap{max-width:480px;margin:12px auto;height:calc(100vh - 24px);display:flex;flex-direction:column;border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);background:linear-gradient(180deg,var(--panel),#040519);}
  header{height:62px;display:flex;align-items:center;padding:8px 12px;gap:10px;border-bottom:1px solid rgba(255,255,255,0.03)}
  header img{width:44px;height:44px;border-radius:50%;border:2px solid #58ff7a}
  header .title{font-weight:700}
  header .status{margin-left:auto;color:#9fbcff;font-size:13px;display:flex;gap:12px;align-items:center}
  header .timer{background:#2b2b5a;padding:6px 10px;border-radius:12px;font-weight:600;box-shadow:0 2px 6px rgba(0,0,0,0.4)}
  main.chat{flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:10px;position:relative}
  .msg{max-width:78%;padding:10px 12px;border-radius:16px;line-height:1.28;box-shadow:0 6px 18px rgba(0,0,0,0.5)}
  .bot{background:linear-gradient(180deg,var(--bubble-bot),#11113a);align-self:flex-start;border-bottom-left-radius:4px}
  .user{background:linear-gradient(180deg,var(--bubble-user),#0a6fe8);color:#fff;align-self:flex-end;border-bottom-right-radius:4px}
  .small{font-size:12px;opacity:0.85;margin-top:6px}
  .typing{display:flex;gap:6px;align-items:center}
  .dot{width:7px;height:7px;background:#58ff7a;border-radius:50%;opacity:.2;animation:blink 1.2s infinite}
  .dot:nth-child(2){animation-delay:.15s}.dot:nth-child(3){animation-delay:.3s}
  @keyframes blink{0%{opacity:.15}50%{opacity:1}100%{opacity:.15}}

  /* quick replies */
  .quick{display:flex;gap:8px;padding:8px;overflow:auto}
  .quick button{background:linear-gradient(90deg,#1a73ff,#3aa0ff);border:0;padding:8px 12px;border-radius:18px;color:#fff;font-weight:600;cursor:pointer;box-shadow:0 6px 18px rgba(10,80,200,0.18)}

  /* input area fixed bottom */
  .composer{display:flex;gap:8px;padding:10px;border-top:1px solid rgba(255,255,255,0.02);align-items:center;background:linear-gradient(180deg,transparent, rgba(255,255,255,0.01))}
  .input{flex:1;display:flex;align-items:center;background:var(--glass);padding:8px;border-radius:24px;border:1px solid rgba(255,255,255,0.03)}
  .input input{flex:1;border:0;background:transparent;padding:8px 10px;color:#eef2ff;outline:none;font-size:15px}
  .send{background:linear-gradient(180deg,#60ff9e,#2ed66b);border:none;border-radius:50%;width:44px;height:44px;display:grid;place-items:center;cursor:pointer;box-shadow:0 8px 24px rgba(46,214,107,0.12)}
  .send svg{width:18px;height:18px;fill:#041126}
  /* starry BG */
  #stars{position:absolute;inset:0;pointer-events:none;z-index:0;opacity:.12}
  /* small screens tweak */
  @media(min-width:860px){.wrap{margin-top:30px;height:86vh}}
  /* footer note */
  .note{font-size:12px;opacity:.6;text-align:center;padding:8px}
</style>
</head>
<body>
<div class="wrap" role="application" aria-label="Shayari Chat">
  <header>
    <img id="avatar" src="https://i.pravatar.cc/64?img=12" alt="Prabhav Baba"/>
    <div>
      <div class="title">Prabhav Baba  </div>
      <div class="small">20+ years Astrologer • Tantrik</div>
    </div>
    <div class="status">
      <div style="width:10px;height:10px;background:#58ff7a;border-radius:50%;box-shadow:0 0 8px #58ff7a"></div>
      <div class="timer" id="timer">00:00</div>
    </div>
  </header>

  <main class="chat" id="chat">
    <div id="stars"></div>

    <!-- initial bot prompt -->
    <div class="msg bot" id="welcome">Namaste! Apna naam/ date of birth/ place of birth batao, main aapka future dekh k bataunga💫</div>
  </main>

  

  <form class="composer" id="composer">
    <div class="input" role="textbox" aria-label="Type message">
      <input id="inputBox" autocomplete="off" placeholder="name/dob/place"/>
    </div>
    <button class="send" aria-label="Send" type="submit" id="sendBtn">
      <svg viewBox="0 0 24 24"><path d="M2 21l21-9L2 3v7l15 2-15 2z"></path></svg>
    </button>
  </form>

  

<script>
/* ===========================
 Single-file Shayari Maker using Groq OpenAI-compatible endpoint
 Replace YOUR_GROQ_API_KEY with your key from console.groq.com/keys
 Set MODEL to a model visible in your Groq console (default: "gpt-3.5-turbo" for compatibility)
 ============================ */

const GROQ_API_KEY = "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"; // <<< REPLACE THIS (client-side exposes it)
const MODEL = "llama3-8b-8192";            // Use a valid Groq model (e.g., llama3-8b-8192, llama3-70b-8192)
const ENDPOINT = "https://api.groq.com/openai/v1/chat/completions";

const chat = document.getElementById('chat');
const inputBox = document.getElementById('inputBox');
const sendBtn = document.getElementById('sendBtn');
const quickReplies = document.getElementById('quickReplies');
const timerEl = document.getElementById('timer');

let sessionId = 's_' + Math.random().toString(36).slice(2,10);
let conversation = []; // local history for context (role: user/assistant)
let timerInterval = null;

/* small starry background */
(function makeStars(){
  const s = document.getElementById('stars');
  for(let i=0;i<40;i++){
    const el = document.createElement('div');
    el.style.position='absolute';
    el.style.width = (Math.random()*2+1)+'px';
    el.style.height = el.style.width;
    el.style.background = '#fff';
    el.style.opacity = Math.random()*0.9;
    el.style.left = (Math.random()*100)+'%';
    el.style.top = (Math.random()*100)+'%';
    el.style.borderRadius='50%';
    s.appendChild(el);
  }
})();

/* utility to append message bubble */
function appendMsg(text, who='bot', small='') {
  const d = document.createElement('div');
  d.className = 'msg ' + (who==='bot' ? 'bot' : 'user');
  d.innerHTML = `<div>${escapeHtml(text)}</div>` + (small ? `<div class="small">${escapeHtml(small)}</div>` : '');
  chat.appendChild(d);
  chat.scrollTop = chat.scrollHeight;
}

/* escape simple HTML */
function escapeHtml(s){ return String(s).replaceAll('<','&lt;').replaceAll('>','&gt;'); }

/* typing indicator */
function showTyping(show=true){
  const id = 'typingInd';
  let el = document.getElementById(id);
  if(show){
    if(!el){
      el = document.createElement('div'); el.id=id; el.className='msg bot typing';
      el.innerHTML = '<div class="typing"><div class="dot"></div><div class="dot"></div><div class="dot"></div>Prabhav soch raha...</div>';
      chat.appendChild(el); chat.scrollTop = chat.scrollHeight;
    }
  } else {
    el = document.getElementById(id);
    if(el) el.remove();
  }
}

/* fallback offline shayari when API fails */
const FALLBACKS = [
  name => `O ${name}, tumhare janam nakshatra ke hisaab se aane wale dino mein ek nayi shuruaat ka yog ban raha hai, par ek purani baat tumhare mann ko abhi bhi bandh ke rakhi hai.`,
  name => `${name}, tumhari kundli ke grah is waqt tumhare paksh mein hai, lekin ek chhoti si savdhaani tumhare liye bade laabh ka kaaran ban sakti hai.`,
  name => `Tare aur grah tumhari disha badalne wale hain ${name}, bas tumhe apne faislon mein thoda sa dhairya rakhna hoga aur sahi samay ka intezaar karna hoga.`
];


/* function to call Groq (OpenAI-compatible) */
async function callGroqGenerate(name) {
  // Compose a friendly system+user prompt to produce a shayari in Hinglish
  const system = {
    role: "system",
    content: "Tum ek professional Indian astrologer tantrik ho jo hinglish me friendly but thoda traditional tone me baat karta hai. Tum hamesha ek hi response me teen cheezein batate ho:1. Future prediction – user ke naam, date of birth, aur place of birth ke hisaab se kundli dekh ke aage ka samay kaisa hoga.2. Reason – jaise ki kundli me kaunse grah ya nakshatra ka prabhav hai, koi dosh, shani ka prakop, mangal ka prabhav, ya yog bane huye hain, unka short explanation do.3. Remedy – ek simple upay ya suggestion jo user apne life me apply karke apni situation better kar sake. Remedy simple aur ghar pe karne layak ho.Tum apna jawab ek hi paragraph me likhoge, bina bullet points ke, casual hinglish me jaise ek pandit friendly tarike se samjhata hai, lekin jyotish shastra ke concepts use karke." };

  const user = {
    role: "user",
    content: `Mere naam , janm sthal or date of birth  ${name} hai. , Is jaankari ke adhar par mera aane wala future m acha or ky bura ho sakta batao, iska reason bhi btana kundli ke hisaab se ya planets ki position k hisab se like shani ka prakop ya jo bhi...naam or dob k according...,....response hindi mai hona chahiye. or emojis use karna in between. Writing style darawana tantrik jaisa ho.Write entire your response in pure hindi.response should be in 650 characters or less.
`
  };

  // Prepare payload compatible with OpenAI chat/completions
  const payload = {
    model: MODEL,
    messages: [system, user],
    max_tokens: 220,
    temperature: 0.9,
    top_p: 0.95
  };

  // Use fetch to Groq endpoint
  const res = await fetch(ENDPOINT, {
    method: "POST",
    headers: {
      "Content-Type":"application/json",
      "Authorization": `Bearer ${GROQ_API_KEY}`
    },
    body: JSON.stringify(payload)
  });

  if(!res.ok){
    // handle rate limit specifically
    if(res.status === 429) throw new Error("Rate limited (429) from Groq");
    const txt = await res.text();
    throw new Error("Groq API Error: " + (txt || res.statusText));
  }
  const data = await res.json();
  // Groq's OpenAI-compatible response structure: data.choices[0].message.content
  const content = data?.choices?.[0]?.message?.content;
  if(!content) throw new Error("No content from Groq");
  return content.trim();
}

/* send flow: when user sends name, generate poem */
async function handleSend(name) {
  if(!name || !name.trim()) return;
  inputBox.value = '';
  appendMsg(name, 'user', '');
  showTyping(true);
  try {
    const poem = await callGroqGenerate(name.trim());
    showTyping(false);
    appendMsg(poem, 'bot', 'Yeh apka bhavisha hai ❤️');
  } catch(err) {
    console.error('Groq error', err);
    showTyping(false);
    // fallback: pick random
    const fallback = FALLBACKS[Math.floor(Math.random()*FALLBACKS.length)](name.trim());
    appendMsg(fallback, 'bot', 'Offline fallback shayari (API failed)');
  }
}

/* quick replies (common names for testing) */
function showQuick() {
  quickReplies.innerHTML = '';
  ["Rahul","Priya","Aman","Sakshi"].forEach(n=>{
    const b = document.createElement('button');
    b.textContent = n;
    b.onclick = ()=> handleSend(n);
    quickReplies.appendChild(b);
  });
  quickReplies.style.display = 'flex';
}

/* keyboard submit */
document.getElementById('composer').addEventListener('submit', e=>{
  e.preventDefault();
  const v = inputBox.value.trim();
  if(!v) return;
  handleSend(v);
});

/* small timer visual: counts seconds since page open */
let seconds = 0;
timerEl.textContent = '00:00';
timerInterval = setInterval(()=> {
  seconds++;
  const mm = String(Math.floor(seconds/60)).padStart(2,'0');
  const ss = String(seconds%60).padStart(2,'0');
  timerEl.textContent = `${mm}:${ss}`;
},1000);

/* initial quick replies */
showQuick();

/* safety: warn user if GROQ_API_KEY not replaced */
if(GROQ_API_KEY === "YOUR_GROQ_API_KEY"){
  appendMsg("⚠️ Reminder: Replace GROQ_API_KEY in the HTML before using the real API (or you'll get errors). For production, proxy requests via a server to keep the key secret.", 'bot','Developer note');
}
</script>
</body>
</html>
